(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["playerFigure"],{"035e":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"playerFigure"},[i("transition",{attrs:{name:"pageTransition"}},[i("router-view")],1)],1)},n=[],s=i("ec45"),o={name:"playerFigure",mixins:[s["a"]]},r=o,c=(i("8669"),i("2877")),h=Object(c["a"])(r,a,n,!1,null,"be642faa",null);e["default"]=h.exports},"0cfd":function(t,e){var i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAA8CAYAAAAgwDn8AAACEElEQVRoQ+2YP0vDUBTFWydxKR3cjYjQrXV2E6GCOjj6BSoO4uji5Oygk/0CTuIggqL4FWwXKTg0OjuULsVJJRcOmIfPl+akNC/cLK9Jc2/eOb93b/6US55vZc/nX1IB0yaoBJQA6YAuIdJAOlwJ0BaSCZQAaSAdrgRoC8kESoA0kA5XArSFZAIlQBpIhysB2kIygRIgDaTDlQBtIZlgYgTuWmvf0dyam/VSeet0YtfJPHEQBDLx7bkv8fZmNCMj9s9e3jO9ZqbJoom6BDRXl0TQRvspk2vTSTBhLOX2/IL8XD9ekfHw6CpG4veSD8OQvj6dwFsBmDgctzUTkHg8eZZTWh9vMmbhfpQnNQFvBZgT77wOY+ZfVAeybyMDAghiSYxNoHACTEf3BlUxt7Fc+bMsckfAGwG2pYM173IeOCAY5yM+bS0kroHCCDCdg7M4jn1XDUyNgHcCsHT65zuxrrJ4cB3bT0rArAX2fuCsgcIJuL/timnRi0q0gUStvmt7HPr3eK97ST0bjU2gMAL2H/oxZ00CYdiT/z+HHRlnKw0Zg6AWi5saAW8EwC7zxQV3ThwHAdN523nIO3EChRFgayUmAZujOA+1gNpI+wyE+Ti7kKs3eivAdBRCbc7mjkDhBLjWdO4JeCNg3KVjtmF0IVfNuJpH6i7krQDbhyx8F3K92yLefHdOGm8jkvg+kFcBP4CLukzprsMQAAAAAElFTkSuQmCC",a="data:image/png;base64,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QJCAS11x/XWW3eNV1uNUWfZDAq5rF73vlrX14l0nCbjs9LPga34dodbysR5477UHGTUU67nYXhVWqdxYkWjvZs0K+N51jTrOu2fqtf9amXIpXlZLFP1h1IrSuwWWjXepnqzrti0uaWdBrPhr4TD3cyux1vZ+kQdr2RkJeG81g9k2QycBz3XJ1etJwOvxzE7oSMCbDzvW9QL7bqO0cG1JN/s3niUYloDx5duWQ47S8x9FjlqGolVelj6i85/U8d6WrYb36PY2unyW3SERZ1dUlrzH9fOoHUXHt8It2tKPjo/K7a6AScBRaOeN11olJOB5uFpXk4AthHI/JwHn4i+zRwk1Or7VKqOEGh0fldskYLlhtMKKtiiignvHjyKHV140cPyi617P/UXlPS7j525BjG5vo8tn2VHrgGjNf9I/L7Wf0uta4Y12pD3O6B1XKicJGPaAS4GsfZ22F0kCro306v1IwPNOdbbVjv9bt1rLcVLvX0qkpde1wtlLrN5xpXK634QVnUAjELlPLyIZRY4ofqyESxHLvW50extdPq/2WAl7kaozDrdm5K43bj9Y/mq9EEezO+/1dVZxcBdvou0dVyofCfje9HL/aIu9FPDodayEo4jljh+d4EaXz6s9ErAXqTrjSMATjrV54j+6b6APf3n2UgAAAABJRU5ErkJggg==";function n(t){var e=document.createElement("img");return e.src=t,e}var s=n(i),o=n(a);t.exports={oneBodyImg:s,headLessBodyGroupImg:o}},"11dd":function(t,e,i){"use strict";var a=i("b669"),n=i.n(a);n.a},"4be3":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"pictureEdit"}},[0!=t.imgSrc.length||null!=t.imgData?i("div",{staticClass:"pictureEditContainer"},[i("div",{staticClass:"canvasContainer",style:t.cursor,on:{mousedown:function(e){return t.editCanvas(e)},mousemove:function(e){return t.getEraserPos(e)}}},[i("canvas",{staticClass:"pictureEditCanvas",style:t.canvasDimension,attrs:{width:t.canvasDimension.width,height:t.canvasDimension.height}}),"crop"==t.mode?i("div",{staticClass:"cropFrame",style:t.cropFrameDimension,on:{mousedown:function(e){return e.stopPropagation(),t.moveCropFrame(e)}}}):"erase"==t.mode?i("div",{staticClass:"eraser",style:t.eraserStyle}):t._e()]),i("div",{staticClass:"reInput",on:{click:function(e){return t.reInput()}}},[i("font-awesome-icon",{attrs:{icon:"angle-left"}}),t._v(" 重新导入\n    ")],1),i("div",{staticClass:"done",on:{click:function(e){return t.done()}}},[t._v("\n      下一步\n      "),i("font-awesome-icon",{attrs:{icon:"angle-right"}})],1),i("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],staticClass:"resize",attrs:{type:"range",min:"0.5",max:"3",step:"0.05"},domProps:{value:t.scale},on:{input:function(e){return e.stopPropagation(),t.resize(e)},__r:function(e){t.scale=e.target.value}}}),i("div",{staticClass:"pictureEdit_toolKit"},[i("div",{staticClass:"drag",on:{click:function(e){t.mode="drag"}}},[i("font-awesome-icon",{attrs:{icon:"mouse-pointer"}})],1),"crop"==t.mode?i("div",{staticClass:"cropState"},[i("span",{staticClass:"cutBtn",on:{click:function(e){return t.cutCanvas()}}},[i("font-awesome-icon",{attrs:{icon:"cut"}})],1),i("span",{staticClass:"removeCropFrameBtn",on:{click:function(e){return t.removeCropFrame()}}},[i("font-awesome-icon",{staticClass:"fa-sm",attrs:{icon:"minus"}})],1)]):i("div",{staticClass:"crop",on:{click:function(e){t.mode="crop"}}},[i("font-awesome-icon",{staticClass:"fa-xs",attrs:{icon:"crop"}})],1),"erase"==t.mode?i("div",{staticClass:"eraseState"},[i("span",{on:{click:function(e){t.eraserStyle.width=t.eraserStyle.height="10px"}}},[i("font-awesome-icon",{staticClass:"fa-xs",attrs:{icon:"circle"}})],1),i("span",{on:{click:function(e){t.eraserStyle.width=t.eraserStyle.height="20px"}}},[i("font-awesome-icon",{staticClass:"fa-sm",attrs:{icon:"circle"}})],1),i("span",{on:{click:function(e){t.eraserStyle.width=t.eraserStyle.height="30px"}}},[i("font-awesome-icon",{staticClass:"fa-2px",attrs:{icon:"circle"}})],1),i("span",{staticClass:"removeCropFrameBtn",on:{click:function(e){t.mode="drag"}}},[i("font-awesome-icon",{staticClass:"fa-sm",attrs:{icon:"minus"}})],1)]):i("div",{staticClass:"erase",on:{click:function(e){t.mode="erase"}}},[i("font-awesome-icon",{attrs:{icon:"eraser"}})],1),i("div",{staticClass:"undo",staticStyle:{"font-weight":"blod"},on:{click:function(e){return t.undo()}}},[i("font-awesome-icon",{attrs:{icon:"arrow-left"}})],1),i("div",{staticClass:"reset",on:{click:function(e){return t.reset()}}},[t._v("↻")])])]):t._e(),i("br"),0==t.imgSrc.length&&null==t.imgData?i("button",{staticClass:"inputImageBtn",on:{click:function(e){return t.addPicture()}}},[t._v("导入照片")]):t._e()])},n=[],s=i("a4bb"),o=i.n(s),r=i("f499"),c=i.n(r),h=i("7618");i("c5f6");function u(t){if("string"==typeof t)return Number(t.slice(0,t.length-2));if("object"==Object(h["a"])(t)){for(var e=JSON.parse(c()(t)),i=0,a=o()(t);i<a.length;i++){var n=a[i];e[n]=u(t[n])}return e}return t}i("6762"),i("ac6a");function l(t,e,i,a){for(var n=v(i),s=[],o={width:a.width,height:a.height},r=0;r<n.length;r++)for(var c=0;c<n[r];c++){var h=t-c,u=t+c,l=e-r,f=e+r,d=m(h,l,o),g=m(h,f,o),C=m(u,l,o),p=m(u,f,o),A=[d,g,C,p];A.forEach(function(t){null!=t&&(s.includes(t)||s.push(t))})}for(var w=0;w<s.length;w++)a.data[4*s[w]]=255,a.data[4*s[w]+1]=255,a.data[4*s[w]+2]=255,a.data[4*s[w]+3]=0;return a}function v(t){for(var e=[],i=0;i<t;i++){var a=Math.sqrt(t*t-i*i),n=Math.sqrt(t*t-(i+1)*(i+1)),s=Math.round((a+n)/2);e.push(s)}return e}function m(t,e,i){return t>i.width||t<0||e>i.height||e<0?null:i.width*e+t}var f=i("ec45"),d={name:"pictureEdit",mixins:[f["a"]],mounted:function(){if(null!=this.imgData){var t=this.$store.state.playerFigure,e=t.x,i=t.y;this.drawCanvas(this.imgData,e,i),this.historyUpdate()}},data:function(){return{imgSrc:"",historyData:[],canvasDimension:{width:700,height:400,top:0,left:0,transform:"scale(1)"},scale:1,cropFrameDimension:{width:0,height:0,top:0,left:0},mode:"drag",eraserStyle:{width:"10px",height:"10px",top:"0px",left:"0px"}}},computed:{imgData:function(){return this.$store.state.playerFigure.imgData},context:function(){return document.querySelector(".pictureEditCanvas").getContext("2d")},canvasContainer:function(){return 0==this.imgSrc.length&&null==this.imgData?null:document.getElementsByClassName("canvasContainer")[0]},canvasDOM:function(){return 0==this.imgSrc.length&&null==this.imgData?null:document.getElementsByClassName("pictureEditCanvas")[0]},cursor:function(){switch(this.mode){case"drag":return{cursor:"default"};case"crop":return{cursor:"crosshair"};case"erase":return{cursor:"none"}}}},methods:{reInput:function(){this.$store.commit("playerFigure/clearAll"),this.imgSrc="",this.$router.push("/playerFigure/combine")},uploadData:function(){var t=this.$store.state.playerFigure,e=t.x,i=t.y,a=t.width,n=t.height;a=null==a?this.canvasDimension.width:a,n=null==n?this.canvasDimension.height:n;var s=this.context.getImageData(e,i,a,n);this.$store.commit("playerFigure/uploadImgData",{imgData:s,width:a,height:n})},done:function(){var t=window.confirm("已完成剪切，要进入下一步？");0!=t&&(this.uploadData(),this.$router.push({path:"/playerFigure/combine"}))},resize:function(t){this.canvasDimension.transform="scale(".concat(t.target.value,")")},reset:function(){""==this.imgSrc&&(this.imgSrc=this.$store.state.playerFigure.src),this.context.clearRect(0,0,this.canvasDimension.width,this.canvasDimension.height),this.initCanvas()},undo:function(){if(!(this.historyData.length<2)){this.historyData.shift();var t=this.historyData[0].imageData;this.drawCanvas(t)}},editCanvas:function(t){switch(this.mode){case"drag":return this.moveCanvas(t);case"crop":return this.drawCropFrame(t);case"erase":return this.eraseCanvas(t)}},eraseCanvas:function(t){var e=this;function i(t){0==t.buttons&&(e.canvasContainer.removeEventListener("mousemove",i),e.historyUpdate());var a=e.mouseImgPosDiff(t),n=a.widthDiff,s=a.heightDiff,o=Math.round(u(e.eraserStyle.width)/e.scale/2),r=Math.round(n/e.scale)+o,c=Math.round(s/e.scale)+o,h=e.context.getImageData(0,0,e.canvasDimension.width,e.canvasDimension.height);l(r,c,o,h),e.drawCanvas(h)}this.canvasContainer.addEventListener("mousemove",i)},getEraserPos:function(t){"erase"==this.mode&&(this.eraserStyle.top=t.clientY-this.canvasContainerRectPos().top+"px",this.eraserStyle.left=t.clientX-this.canvasContainerRectPos().left+"px")},removeCropFrame:function(){this.cropFrameDimension.width=0,this.cropFrameDimension.height=0,this.mode="drag"},cutCanvas:function(){var t=u(this.cropFrameDimension),e=t.width,i=t.height;if(0!=e&&0!=i){var a=this.cropFrameCanvasPosDiff(),n=a.widthDiff,s=a.heightDiff,o=n/this.scale,r=s/this.scale,c=this.context.getImageData(o,r,e/this.scale,i/this.scale);this.$store.commit("playerFigure/uploadImgData",{x:o,y:r,width:e/this.scale,height:i/this.scale}),this.drawCanvas(c,o,r),this.historyUpdate(),this.removeCropFrame()}else alert("点击并拖动鼠标选择要剪切的区域")},moveCropFrame:function(t){var e=this,i=this.mouseCropFramePosDiff(t),a=i.xDiff,n=i.yDiff;function s(t){0==t.buttons&&e.canvasContainer.removeEventListener("mousemove",s),e.cropFrameDimension.top=t.clientY-e.canvasContainerRectPos().top-n+"px",e.cropFrameDimension.left=t.clientX-e.canvasContainerRectPos().left-a+"px"}e.canvasContainer.addEventListener("mousemove",s)},drawCropFrame:function(t){var e=this,i=t.clientX,a=t.clientY;this.canvasContainer.addEventListener("mousemove",o);var n=i-this.canvasContainerRectPos().left,s=a-this.canvasContainerRectPos().top;function o(t){0==t.buttons&&e.canvasContainer.removeEventListener("mousemove",o);var r=t.clientX-i,c=t.clientY-a;e.cropFrameDimension.width=Math.abs(r)+"px",e.cropFrameDimension.height=Math.abs(c)+"px",e.cropFrameDimension.top=c>0?s+"px":s+c+"px",e.cropFrameDimension.left=r>0?n+"px":n+r+"px"}},moveCanvas:function(t){var e=this,i=this.mouseImgPosDiff(t),a=i.widthDiff,n=i.heightDiff;function s(t){0==t.buttons&&e.canvasContainer.removeEventListener("mousemove",s),e.canvasDimension.top=t.clientY-e.canvasContainerRectPos().top-n+e.scaleDiff().yCompensate+"px",e.canvasDimension.left=t.clientX-e.canvasContainerRectPos().left-a+e.scaleDiff().xCompensate+"px"}e.canvasContainer.addEventListener("mousemove",s)},canvasContainerRectPos:function(){return this.canvasContainer.getBoundingClientRect()},canvasRectPos:function(){return this.canvasDOM.getBoundingClientRect()},mouseImgPosDiff:function(t){return{widthDiff:t.clientX-this.canvasRectPos().left,heightDiff:t.clientY-this.canvasRectPos().top}},cropFrameCanvasPosDiff:function(){var t=document.getElementsByClassName("cropFrame")[0].getBoundingClientRect();return{widthDiff:t.left-this.canvasRectPos().left,heightDiff:t.top-this.canvasRectPos().top}},mouseCropFramePosDiff:function(t){var e=document.getElementsByClassName("cropFrame")[0].getBoundingClientRect();return{xDiff:t.clientX-e.left,yDiff:t.clientY-e.top}},scaleDiff:function(){var t=u(this.canvasDimension),e=t.top,i=t.left;return{xCompensate:i-(this.canvasRectPos().left-this.canvasContainerRectPos().left),yCompensate:e-(this.canvasRectPos().top-this.canvasContainerRectPos().top)}},initCanvas:function(){var t=this;if(0!=this.imgSrc.length){var e=new Image;e.src=this.imgSrc,this.$store.commit("playerFigure/uploadImgSrc",this.imgSrc),e.onload=function(){var i=e.width,a=e.height,n=t.canvasDimension,s=n.width,o=n.height,r=s/i<o/a?s/i:o/a;t.context.drawImage(e,0,0,i*r,a*r),t.canvasDimension.top=(t.canvasContainerRectPos().height-a*r)/2+"px",t.canvasDimension.left=(t.canvasContainerRectPos().width-i*r)/2+"px",t.$store.commit("playerFigure/uploadImgData",{width:i*r,height:a*r}),t.historyUpdate()}}},drawCanvas:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.context.clearRect(0,0,this.canvasDimension.width,this.canvasDimension.height),this.context.putImageData(t,e,i)},historyUpdate:function(){var t=this.canvasDimension,e=t.width,i=t.height,a=this.context.getImageData(0,0,e,i);this.historyData.unshift({imageData:a}),this.historyData.length>10&&this.historyData.pop()},addPicture:function(){var t=this,e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.addEventListener("change",function(){if(null!=e.files[0]){var i=new FileReader;i.addEventListener("load",function(){t.imgSrc=i.result,t.initCanvas()}),i.readAsDataURL(e.files[0])}}),e.click(),e.remove()}}},g=d,C=(i("93d5"),i("2877")),p=Object(C["a"])(g,a,n,!1,null,"144231ab",null);e["default"]=p.exports},6583:function(t,e,i){},7594:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"pictureCombine"}},[i("div",{staticClass:"canvasContainer",style:{width:t.canvasContainerSize.width+"px",height:t.canvasContainerSize.height+"px"},on:{mousedown:function(e){return t.moveCanvas(e)}}},[i("canvas",{staticClass:"toCombineCanvas",attrs:{width:t.canvasContainerSize.width,height:t.canvasContainerSize.height,update:t.imgContentPos.top+t.imgContentPos.left+t.rotate+t.flip}}),i("div",{staticClass:"previewContainer",style:{width:t.previewSize.width+"px",height:t.previewSize.height+"px"}},[i("canvas",{staticClass:"previewCanvas",attrs:{width:t.previewSize.width,height:t.previewSize.height}})])]),i("div",{staticClass:"resize"},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.scale,expression:"scale",modifiers:{number:!0}}],attrs:{type:"range",min:"0.5",max:"3",step:"0.05"},domProps:{value:t.scale},on:{__r:function(e){t.scale=t._n(e.target.value)},blur:function(e){return t.$forceUpdate()}}})]),i("div",{staticClass:"goback",on:{click:function(e){return t.goBack()}}},[t._v("返回")]),i("div",{staticClass:"done",on:{click:function(e){return t.generatePlayerFigure()}}},[t._v("下一步")]),i("div",{staticClass:"adjustOptions"},[i("span",{staticClass:"leftRotate",on:{click:function(e){t.rotate-=5}}},[i("font-awesome-icon",{attrs:{icon:"undo"}})],1),i("div",{staticClass:"flip",on:{click:function(e){t.flip=!t.flip}}},[t._v("↔")]),i("span",{staticClass:"rightRotate",on:{click:function(e){t.rotate+=5}}},[t._v("↻")])])])},n=[],s=i("0cfd"),o={name:"PictureCombine",created:function(){null==this.inputCanvasData&&this.$router.push({path:"/playerFigure"})},mounted:function(){null!=this.inputCanvasData&&this.toCombineCanvasContext.putImageData(this.inputCanvasData,0,0)},updated:function(){this.toCombineCanvasContext.clearRect(0,0,this.canvasContainerSize.width,this.canvasContainerSize.height),this.previewCanvasContext.clearRect(0,0,this.previewSize.width,this.previewSize.height),this.drawCanvasAfterTransform(this.inputCanvasImg,this.toCombineCanvasContext,this.imgContentPos.left,this.imgContentPos.top,this.inputCanvasSize.width,this.inputCanvasSize.height),this.drawCanvasAfterTransform(this.inputCanvasImg,this.previewCanvasContext,this.imgContentPos.left*this.ratio,this.imgContentPos.top*this.ratio,this.inputCanvasSize.width*this.ratio,this.inputCanvasSize.height*this.ratio)},data:function(){return{scale:1,rotate:0,flip:!1,imgContentPos:{top:0,left:0},previewSize:{width:48,height:60},canvasContainerSize:{width:320,height:400}}},computed:{inputCanvasData:function(){return this.$store.state.playerFigure.imgData},inputCanvasSize:function(){return{width:this.$store.state.playerFigure.width,height:this.$store.state.playerFigure.height}},inputCanvasImg:function(){if(null==this.inputCanvasData)return null;var t=document.createElement("canvas");t.width=this.inputCanvasSize.width,t.height=this.inputCanvasSize.height;var e=t.getContext("2d");e.putImageData(this.inputCanvasData,0,0);var i=new Image;return i.src=t.toDataURL(),i},toCombineCanvasDOM:function(){var t=document.getElementsByClassName("toCombineCanvas");return t[0]},toCombineCanvasContext:function(){return this.toCombineCanvasDOM.getContext("2d")},canvasContainerDOM:function(){var t=document.getElementsByClassName("canvasContainer");return t[0]},previewCanvasDOM:function(){var t=document.getElementsByClassName("previewCanvas");return t[0]},previewCanvasContext:function(){return this.previewCanvasDOM.getContext("2d")},ratio:function(){return this.previewSize.width/this.canvasContainerSize.width}},methods:{goBack:function(){this.$router.push({path:"/playerFigure"})},moveCanvas:function(t){var e=this,i=this.mouseImgPosDiff(t),a=i.widthDiff,n=i.heightDiff;e.canvasContainerDOM.addEventListener("mousemove",o);var s=null;function o(t){s||setTimeout(function(){0==t.buttons&&e.canvasContainerDOM.removeEventListener("mousemove",o),e.imgContentPos.left=t.clientX-a,e.imgContentPos.top=t.clientY-n,s=null},60),s=t}},mouseImgPosDiff:function(t){return{widthDiff:t.clientX-this.imgContentPos.left,heightDiff:t.clientY-this.imgContentPos.top}},drawCanvasAfterTransform:function(t,e,i,a,n,s){function o(t,e,i){t.translate(e,0),t.scale(-i,i),t.translate(-e,0)}e.save(),e.translate(i,a),1==this.flip?o(e,n/2,this.scale):e.scale(this.scale,this.scale),e.rotate(this.rotate*Math.PI/180),e.drawImage(t,0,0,n,s),e.restore()},generatePlayerFigure:function(){var t=document.createElement("canvas");t.width=480,t.height=600;var e=t.getContext("2d"),i=[2,-2,-3,-4,2,-2,-3,-3,0,-3];e.drawImage(s["headLessBodyGroupImg"],0,0);for(var a=0;a<10;a++)this.drawCanvasAfterTransform(this.inputCanvasImg,e,this.imgContentPos.left*this.ratio+48*a,this.imgContentPos.top*this.ratio+i[a],this.inputCanvasSize.width*this.ratio,this.inputCanvasSize.height*this.ratio);this.$store.commit("gameLevel/changeGlobalPlayerSetting",{playerSprites:t.toDataURL()}),this.$router.push("/entireGame")}}},r=o,c=(i("11dd"),i("2877")),h=Object(c["a"])(r,a,n,!1,null,"7e607f04",null);e["default"]=h.exports},8669:function(t,e,i){"use strict";var a=i("6583"),n=i.n(a);n.a},"8d61":function(t,e,i){},"93d5":function(t,e,i){"use strict";var a=i("8d61"),n=i.n(a);n.a},a21f:function(t,e,i){var a=i("584a"),n=a.JSON||(a.JSON={stringify:JSON.stringify});t.exports=function(t){return n.stringify.apply(n,arguments)}},b669:function(t,e,i){},ec45:function(t,e,i){"use strict";e["a"]={created:function(){this.is_touch_device()&&(alert("游戏设计需在电脑端完成，以获得最佳体验"),this.$router.push("/"))},methods:{is_touch_device:function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},f499:function(t,e,i){t.exports=i("a21f")}}]);
//# sourceMappingURL=playerFigure.7cc7ff24.js.map